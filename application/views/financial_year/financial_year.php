<?phpdefined('BASEPATH') OR exit('No direct script access allowed');$this->load->view('layout/header');?><style type="text/css">    .disable_in {        border: none;        pointer-events: none;        color: #212529 !important;    }    .dt-pkr-bdr {        border-radius: 0;        border: none;    }    .date_error {        border: 1px solid red !important;    }</style><div class="content-wrapper">    <div class="fixed-breadcrumb">        <ol class="breadcrumb abs-ol">            <li>                <a href="<?php echo base_url('auth/dashboard'); ?>"><i class="fa fa-dashboard"></i> Dashboard</a>            </li>            <li class="active">                Financial Year            </li>        </ol>    </div>    <section class="content mt-50">        <div class="row">            <div class="col-md-12">                <div class="box">                    <div class="box-header with-border">                        <h3 class="box-title">Financial Year</h3>                        <a class="btn btn-sm btn-info pull-right add_yr_btn" href="javascript:void(0);">Add Financial Year</a>                    </div>                    <div class="box-body">                        <div id="loader">                            <h1 class="ml8">                                <span class="letters-container">                                    <span class="letters letters-left">                                        <img src="<?php echo base_url('assets/'); ?>images/loader-icon.png" width="40px">                                    </span>                                </span>                                <span class="circle circle-white"></span>                                <span class="circle circle-dark"></span>                                <span class="circle circle-container">                                    <span class="circle circle-dark-dashed"></span>                                </span>                            </h1>                       </div>                        <table id="finance_company" class="custom_datatable table table-bordered table-striped table-hover table-responsive">                            <thead>                                <tr>                                    <th style="display: none;">id</th>                                    <th width="8%">Current FY</th>                                    <th width="20%">From Date</th>                                    <th width="20%">To Date</th>                                    <th width="20%">Status</th>                                    <th width="20%">Action</th>                                </tr>                            </thead>                            <tbody></tbody>                        </table>                    </div>                </div>            </div>        </div>    </section></div><?php$this->load->view('financial_year/add_financial_year');$this->load->view('layout/footer');?><script type="text/javascript">    $(document).ready(function () {        CompTable = GetAllAccYear();        setDatepicker();        $('.add_yr_btn').on('click', function () {            $('#add_fy').find('input[name=year_from_date],[name=year_to_date]').not('[type=radio]').val('');            $('#add_fy').find('select').val('').trigger('change');            $('#add_fy').modal({backdrop: 'static', show: true});        });        $(document).on('click', '.edit_fin_year', function () {            var id = $(this).attr('data-id');            /*disable_all();*/            $('table tbody').find('[data-id="' + id + '"]').removeClass('disable_in');            $('table tbody').find('.datepicker span').removeClass('icon-append');            $('table tbody').find('.date_input[data-id="' + id + '"]').parent().addClass('dt-pkr-bdr');            $('table tbody').find('.date_input[data-id="' + id + '"]').parent().find('span').removeClass('hide');        });        $(document).on('keydown', function(event) {           if (event.key == "Escape") {                $('table tbody').find('tr input').addClass('disable_in');                $('table tbody').find('tr .datepicker').removeClass('dt-pkr-bdr');                $('table tbody').find('tr .datepicker .input-group-addon').addClass('hide');                $('table tbody').find('tr .datepicker').find('span').removeClass('icon-append');                $('table tbody').find('input[type=radio]').each(function () {                    if ($(this).is(':checked')) {                        /*$(this).parent('label').addClass('disable_in');*/                        $(this).removeClass('disable_in');                    }                })               }           });        $(document).on('change', '.current_yr', function () {            var sts = $(this).closest('tr').find('[name=acc_status]');            if (!sts.is(':checked')) {              //  alert('First Active Year Status');                alert_d.text = 'First Active Year Status';                 PNotify.error(alert_d);                return false;            }        });        $(document).on('click', '.submit_acc_detail', function () {            var did = $(this).attr('data-id');            var update_ary = new Array;            var flag = true;            $('table tbody').find('[name=from_date][data-id="' + did + '"]').each(function () {                var tr = $(this).closest('tr');                tr.find('[name=from_date]').parent().removeClass('date_error');                $.each(update_ary, function (k, v) {                    var to_dt = +new Date('01-' + v.to_date);                    var fr_dt = +new Date('01-' + v.from_date);                    var curr_from_date = +new Date('01-' + tr.find('[name=from_date]').val());                    var curr_end_date = +new Date('01-' + tr.find('[name=to_date]').val());                    if (v.to_date == tr.find('[name=to_date]').val() && v.from_date == tr.find('[name=from_date]').val()) {                        tr.find('[name=from_date]').parent().addClass('date_error');                        flag = false;                        return false;                    } else if (to_dt > curr_from_date) {                        if (to_dt < curr_end_date) {                            tr.find('[name=from_date]').parent().addClass('date_error');                            flag = false;                            return false;                        } else if (fr_dt < curr_end_date) {                            tr.find('[name=from_date]').parent().addClass('date_error');                            flag = false;                            return false;                        }                    }/*else if(to_dt < curr_end_date){                     console.log(to_dt,curr_from_date);                                          tr.find('[name=from_date]').parent().addClass('date_error');                     flag = false;                     return false;                     }*/                });                var year_id = $(this).attr('year_id');                var from_date = tr.find('[name=from_date]').val();                var to_date = tr.find('[name=to_date]').val();                var firm_id = tr.find('[name=firm_id]').val();                var acc_id = tr.find('[name=acc_id]').val();                var is_current = 0;                if (tr.find('.current_yr').is(':checked'))                    is_current = 1;                update_ary.push({'year_id': year_id, 'acc_id': acc_id, 'firm_id': firm_id, 'from_date': from_date, 'to_date': to_date, is_current: is_current});            });            if (flag) {                $.ajax({                    url: '<?= base_url(); ?>Financial_year/updateFinanceYear',                    type: 'post',                    dataType: 'json',                    data: {update_ary: JSON.stringify(update_ary)},                                        success: function (j) {                        if (j.flag) {                            /*msg = 'Your Data Updated Successfully';*/                            alert_d.text = 'Financial year updated successfully';                            PNotify.success(alert_d);	                            disable_all();                        } else {                            /*msg = 'Something went wrong!';*/                            alert_d.text = 'Something went wrong!';                            PNotify.error(alert_d);                        }                        /*alert_d.text = msg;                        PNotify.error(alert_d);*/                        //alert(msg);                    }, error: function () {                       alert_d.text = 'Something Went Wrong!';                       PNotify.error(alert_d);                    }                })                            }        });                      $('[name=year_from_date]').parent().datepicker().on('changeMonth', function (e) {            CurrentDate = e.date;            var data_id = $(this).val();            //CurrentDate.setMonth(CurrentDate.getMonth() + 11);            year = CurrentDate.getFullYear();            month = CurrentDate.getMonth() + 1;            var end_dt = ('0' + month).slice(-2) + '-' + year;            $('[name=year_to_date]').val(end_dt);        });        $(document).on('click', '#addNewYear', function () {            var year_from_date = $('#add_fy [name=year_from_date]').val();            var year_to_date = $('#add_fy [name=year_to_date]').val();            var is_current = $('#add_fy [name=is_current]:checked').val();            if (year_from_date == '' || year_to_date == '') {                //alert('All fields mandatory!');                alert_d.text ='All fields Mandatory!';                PNotify.error(alert_d);	                return false;            }            $.ajax({                url: '<?= base_url(); ?>Financial_year/addNewYear',                type: 'post',                dataType: 'json',                 beforeSend: function(){                   // Show image container                   $("#loader").show();                },                data: {year_from_date: year_from_date, year_to_date: year_to_date, is_current: is_current},                success: function (j) {                    if (j.flag) {                        alert_d.text = j.msg;                        PNotify.success(alert_d);                        $("#loader").hide();                        $('#add_fy').modal('hide');                                                $('#add_fy').find('input[name=year_from_date],[name=year_to_date]').not('[type=radio]').val('');                        $('#add_fy').find('select').val('').prop('selected', true);                        CompTable.destroy();                        CompTable = GetAllAccYear();                    } else {                        alert_d.text = j.msg;                                               PNotify.error(alert_d);                        $("#loader").hide();                        /*PNotify.error(alert_d);*/                    }                }, error: function () {                }            })        });anime.timeline({loop:!0}).add({targets:".ml8 .circle-white",scale:[0,3],opacity:[1,0],easing:"easeInOutExpo",rotateZ:360,duration:8e3}),anime({targets:".ml8 .circle-dark-dashed",rotateZ:360,duration:8e3,easing:"linear",loop:!0});    })    function disable_all() {        $('table tbody').find('tr input').addClass('disable_in');        $('table tbody').find('tr .datepicker').removeClass('dt-pkr-bdr');        $('table tbody').find('tr .datepicker .input-group-addon').addClass('hide');        $('table tbody').find('tr .datepicker').find('span').removeClass('icon-append');        $('table tbody').find('input[type=radio]').each(function () {            if ($(this).is(':checked')) {                /*$(this).parent('label').addClass('disable_in');*/                $(this).removeClass('disable_in');            }        })    }    function GetAllAccYear() {        var filter_admin_comp = $('[name=filter_admin_comp]').val();        var filter_acc_name = $('[name=filter_acc_name]').val();        var filter_acc_code = $('[name=filter_acc_code]').val();        var filter_acc_sts = $('[name=filter_acc_sts]').val();        var comp_table = $('#finance_company').DataTable({            "ordering": false,            "searching":false,            "lengthChange": false,            "processing": true,            'ajax': {                url: '<?= base_url(); ?>Financial_year/getAllAccYear',                type: 'post',                data: {filter_admin_comp: filter_admin_comp, filter_acc_name: filter_acc_name, filter_acc_code: filter_acc_code, filter_acc_sts: filter_acc_sts},            },            'columns': [                {'data': 'year_id'},                /*{'data': 'company_name'},                 {'data': 'acc_name'},*/                {'data': 'is_current'},                {'data': 'from_date'},                {'data': 'to_date'},                {'data': 'status'},                {'data': 'action'},                        /*{'data' : 'status'}*/],            /*'order' : [[0, 'desc']],*/            "columnDefs": [                {"visible": false, "targets": 0}            ],            'language': {                'loadingRecords': '&nbsp;',                'processing': ' <h1 class="ml8"><span class="letters-container"> <span class="letters letters-left"><img src="<?php echo base_url('assets/'); ?>images/loader-icon.png" width="30px"></span></span><span class="circle circle-white"></span><span class="circle circle-dark"></span><span class="circle circle-container"><span class="circle circle-dark-dashed"></span></span></h1>'                },            });                     anime.timeline({loop:!0}).add({targets:".ml8 .circle-white",scale:[0,3],opacity:[1,0],easing:"easeInOutExpo",rotateZ:360,duration:8e3}),anime({targets:".ml8 .circle-dark-dashed",rotateZ:360,duration:8e3,easing:"linear",loop:!0});        return comp_table;    }       function setDatepicker() {        $('div.datepicker').each(function () {            $(this).datepicker({                enableOnReadonly: true,                format: "mm-yyyy",                startView: "months",                autoclose: true,                minViewMode: "months"            });        });        $('[name=year_from_date]').parent().datepicker().on('changeMonth', function (e) {            CurrentDate = e.date;            var data_id = $(this).val();            CurrentDate.setMonth(CurrentDate.getMonth() + 11);            year = CurrentDate.getFullYear();            month = CurrentDate.getMonth() + 1;            var end_dt = ('0' + month).slice(-2) + '-' + year;            $('[name=year_to_date]').val(end_dt);        });        setTimeout(function () {            $(document).find('div.datepicker').each(function () {                $(this).datepicker({                    enableOnReadonly: true,                    format: "mm-yyyy",                    startView: "months",                    autoclose: true,                    minViewMode: "months",                    changeMonth: function (e) {                    }                });                $(this).datepicker().on('changeMonth', function (e) {                    CurrentDate = e.date;                    var data_id = $(this).val();                    CurrentDate.setMonth(CurrentDate.getMonth() + 11);                    year = CurrentDate.getFullYear();                    month = CurrentDate.getMonth() + 1;                    var end_dt = ('0' + month).slice(-2) + '-' + year;                    $(this).closest('tr').find('[name=to_date]').val(end_dt);                });            })        }, 2000);    }    function doconfirm_status(ths) {        var id = ths.attr('data-id');        var msg = "Are you sure want to Inactive Status..?";        var sts = 0;        var tr = ths.closest('tr');        if (tr.find('.current_yr').is(':checked')) {            alert_d.text ='Change Current year status first!';            PNotify.error(alert_d);            /*alert_d.text = 'Change Current year status first';             PNotify.error(alert_d);*/            return false;        }        if (ths.is(":checked")) {            msg = "Are you sure want to Active Status..?";            sts = 1;        }        if (confirm(msg)) {            $.ajax({                url: '<?= base_url(); ?>Financial_year/changeYearStatus',                type: 'post',                dataType: 'json',                data: {id: id, sts: sts},                success: function (j) {                    if(j){                        alert_d.text ='Status Updated Successfully!';                        PNotify.success(alert_d);                    } else {                        alert_d.text ='Status Updated Unsuccessful';                        PNotify.error(alert_d);                    }                }, error: function () {                }            });        } else {            return false;        }    }  </script>